# Сервер Express

## Содержание

### [Сервер Express](#сервер-express)

-   [Роутинг](#роутинг)
    -   [Маршруты API /auth](#маршруты-api-auth)
        -   [GET /validate-access-token](#get-validate-access-token)
        -   [GET /logout](#get-logout)
        -   [GET /login](#get-login)
        -   [POST /signup](#post-signup)
    -   [Особенности реализации](#особенности-реализации)

### [Структура базы данных](#структура-базы-данных)

-   [Location (Локация)](#1-location-локация)
-   [Schedule (Расписание)](#2-schedule-расписание)
-   [User (Пользователь)](#3-user-пользователь)
-   [Card (Карточка)](#4-card-карточка)
-   [SportsObject (Спортивный объект)](#5-sportsobject-спортивный-объект)
-   [Основные отношения](#основные-отношения)

## Роутинг

### Маршруты API `/auth`

#### `GET /validate-access-token`

-   **Назначение**: Валидация access token из cookies
-   **Ответ**:
    -   200: Возвращает декодированный токен, если он валиден
    -   200: Возвращает сам cookie, если токен невалиден

#### `GET /logout`

-   **Назначение**: Выход из системы (очистка cookies)
-   **Ответ**:
    -   200: Успешный выход

#### `GET /login`

-   **Назначение**: Тестовый вход в систему (для демонстрации)
-   **Действия**:
    -   Создает тестовый access token для пользователя `exampleUser`
    -   Устанавливает cookie `access_token` с сроком жизни 7 дней
-   **Ответ**:
    -   200: Возвращает сгенерированный токен

#### `POST /signup`

-   **Назначение**: Регистрация нового пользователя
-   **Параметры**:
    ```json
    {
    	"user": {
    		"email": "string (обязательно)",
    		"password": "string (обязательно)",
    		"...": "другие данные пользователя"
    	}
    }
    ```
-   **Проверки**:
    -   Наличие credentials (400 если отсутствуют)
    -   Наличие email и password (400 если отсутствуют)
    -   Уникальность email (400 если email уже занят)
-   **Действия**:
    -   Хеширует пароль
    -   Создает запись пользователя в БД
-   **Ответ**:
    -   200: Возвращает данные пользователя (без пароля)
    -   400: При ошибках валидации

#### Особенности реализации

-   Использует HTTP-only cookies для хранения токена

## Структура базы данных

Схема базы данных: [prisma/schema.prisma](./prisma/schema.prisma)

### 1. Location (Локация)

Представляет географические координаты спортивных объектов.

**Поля:**

-   `id` - Уникальный идентификатор (UUID)
-   `x` - Координата X (широта)
-   `y` - Координата Y (долгота)
-   `SportsObject` - Связанный спортивный объект (опционально, отношение один-к-одному)

### 2. Schedule (Расписание)

Определяет время доступности спортивного объекта.

**Поля:**

-   `id` - Уникальный идентификатор (UUID)
-   `dayOfWeek` - День недели
-   `startTime` - Время начала работы
-   `endTime` - Время окончания работы
-   `card` - Связанная карточка (отношение многие-к-одному)
-   `cardId` - ID связанной карточки

### 3. User (Пользователь)

Содержит информацию о пользователях системы.

**Поля:**

-   `id` - Уникальный идентификатор (UUID)
-   `hashedPassword` - Хэшированный пароль
-   `email` - Email (уникальный)
-   `phone` - Телефон (опционально)
-   `tgUsername` - Имя пользователя в Telegram (опционально)
-   `name` - Имя (опционально)
-   `age` - Возраст (опционально)
-   `card` - Связанная карточка (опционально, один-к-одному)
-   `Card_UserLikedCards` - Понравившиеся карточки (отношение многие-ко-многим)

### 4. Card (Карточка)

Основная сущность для работы с спортивными объектами.

**Поля:**

-   `id` - Уникальный идентификатор (UUID)
-   `User_UserLikedCards` - Пользователи, которым понравилась карточка (отношение многие-ко-многим)
-   `schedules` - Расписания работы
-   `SportsObject_CardAddedObjects` - Связанные спортивные объекты
-   `author` - Автор карточки (отношение один-к-одному)
-   `authorId` - ID автора (уникальный)

### 5. SportsObject (Спортивный объект)

Детальная информация о спортивном объекте.

**Поля:**

-   `global_id` - Глобальный идентификатор (первичный ключ)
-   `Card_CardAddedObjects` - Связанные карточки
-   `location` - Локация объекта (отношение один-к-одному)
-   `locationId` - ID локации (уникальный)
-   Многочисленные поля с информацией об объекте:
    -   Названия (`ObjectName`, `NameWinter`)
    -   Адресные данные (`AdmArea`, `District`, `Address`)
    -   Контакты (`Email`, `WebSite`, `HelpPhone`)
    -   Время работы (`WorkingHoursWinter`, `ClarificationOfWorkingHoursWinter`)
    -   Удобства и услуги (`HasEquipmentRental`, `HasTechService`, `HasToilet` и др.)
    -   Характеристики (`DimensionsWinter`, `Lighting`, `SurfaceTypeWinter`)
    -   Прочая информация (`Paid`, `DisabilityFriendly`, `ServicesWinter` и др.)

### Основные отношения

-   Пользователь может создавать карточки
-   Карточки могут содержать несколько спортивных объектов
-   Каждый спортивный объект имеет свою локацию
-   Карточки могут иметь расписания
-   Пользователи могут отмечать понравившиеся карточки
